!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("echarts")):"function"==typeof define&&define.amd?define(["echarts"],n):"object"==typeof exports?exports["echarts-graph-modularity"]=n(require("echarts")):t["echarts-graph-modularity"]=n(t.echarts)}(window,function(t){return function(t){var n={};function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=11)}([function(t,n){t.exports=function(t){!function(t){if(!t)throw new Error("Eventify cannot use falsy object as events subject");for(var n=["on","fire","off"],e=0;e<n.length;++e)if(t.hasOwnProperty(n[e]))throw new Error("Subject cannot be eventified, since it already has property '"+n[e]+"'")}(t);var n=function(t){var n=Object.create(null);return{on:function(e,o,i){if("function"!=typeof o)throw new Error("callback is expected to be a function");var r=n[e];return r||(r=n[e]=[]),r.push({callback:o,ctx:i}),t},off:function(e,o){var i=void 0===e;if(i)return n=Object.create(null),t;if(n[e]){var r="function"!=typeof o;if(r)delete n[e];else for(var s=n[e],u=0;u<s.length;++u)s[u].callback===o&&s.splice(u,1)}return t},fire:function(e){var o,i=n[e];if(!i)return t;arguments.length>1&&(o=Array.prototype.splice.call(arguments,1));for(var r=0;r<i.length;++r){var s=i[r];s.callback.apply(s.ctx,o)}return t}}}(t);return t.on=n.on,t.off=n.off,t.fire=n.fire,t}},function(t,n,e){t.exports=function(t){void 0===(t=t||{}).uniqueLinkId&&(t.uniqueLinkId=!0);var n="function"==typeof Object.create?Object.create(null):{},e=[],c={},h=0,a=0,d=Object.keys?L:M,f=t.uniqueLinkId?function(t,n,e){var o=u(t,n),i=c.hasOwnProperty(o);if(i||E(t,n)){i||(c[o]=0);var r="@"+ ++c[o];o=u(t+r,n+r)}return new s(t,n,e,o)}:function(t,n,e){var o=u(t,n);return new s(t,n,e,o)},g=[],l=I,p=I,m=I,v=I,C={addNode:W,addLink:function(t,n,o){m();var i=b(t)||W(t),s=b(n)||W(n),u=f(t,n,o);e.push(u),r(i,u),t!==n&&r(s,u);return l(u,"add"),v(),u},removeLink:x,removeNode:N,getNode:b,getNodesCount:function(){return h},getLinksCount:function(){return e.length},getLinks:function(t){var n=b(t);return n?n.links:null},forEachNode:d,forEachLinkedNode:function(t,e,o){var i=b(t);if(i&&i.links&&"function"==typeof e)return o?function(t,e,o){for(var i=0;i<t.length;++i){var r=t[i];if(r.fromId===e&&o(n[r.toId],r))return!0}}(i.links,t,e):function(t,e,o){for(var i=0;i<t.length;++i){var r=t[i],s=r.fromId===e?r.toId:r.fromId;if(o(n[s],r))return!0}}(i.links,t,e)},forEachLink:function(t){var n,o;if("function"==typeof t)for(n=0,o=e.length;n<o;++n)t(e[n])},beginUpdate:m,endUpdate:v,clear:function(){m(),d(function(t){N(t.id)}),v()},hasLink:E,getLink:E};return o(C),w=C.on,C.on=function(){return C.beginUpdate=m=O,C.endUpdate=v=j,l=y,p=k,C.on=w,w.apply(C,arguments)},C;var w;function y(t,n){g.push({link:t,changeType:n})}function k(t,n){g.push({node:t,changeType:n})}function W(t,e){if(void 0===t)throw new Error("Invalid node identifier");m();var o=b(t);return o?p(o,"update"):(o=new function(t){this.id=t,this.links=null,this.data=null}(t),h++,p(o,"add")),o.data=e,n[t]=o,v(),o}function b(t){return n[t]}function N(t){var e=b(t);if(!e)return!1;if(m(),e.links)for(;e.links.length;){var o=e.links[0];x(o)}return delete n[t],h--,p(e,"remove"),v(),!0}function x(t){if(!t)return!1;var n=i(t,e);if(n<0)return!1;m(),e.splice(n,1);var o=b(t.fromId),r=b(t.toId);return o&&(n=i(t,o.links))>=0&&o.links.splice(n,1),r&&(n=i(t,r.links))>=0&&r.links.splice(n,1),l(t,"remove"),v(),!0}function E(t,n){var e,o=b(t);if(!o||!o.links)return null;for(e=0;e<o.links.length;++e){var i=o.links[e];if(i.fromId===t&&i.toId===n)return i}return null}function I(){}function O(){a+=1}function j(){0===(a-=1)&&g.length>0&&(C.fire("changed",g),g.length=0)}function L(t){if("function"==typeof t)for(var e=Object.keys(n),o=0;o<e.length;++o)if(t(n[e[o]]))return!0}function M(t){var e;if("function"==typeof t)for(e in n)if(t(n[e]))return!0}};var o=e(0);function i(t,n){if(!n)return-1;if(n.indexOf)return n.indexOf(t);var e,o=n.length;for(e=0;e<o;e+=1)if(n[e]===t)return e;return-1}function r(t,n){t.links?t.links.push(n):t.links=[n]}function s(t,n,e,o){this.fromId=t,this.toId=n,this.data=e,this.id=o}function u(t,n){return function(t){var n,e,o=0;if(0==t.length)return o;for(n=0,e=t.length;n<e;n++)o=(o<<5)-o+t.charCodeAt(n),o|=0;return o}(t.toString()+"ðŸ‘‰ "+n.toString())}},function(n,e){n.exports=t},function(t,n){t.exports=function(t,n){var e,o=[],i=[],r=Object.create(null),s=Object.create(null),u=Object.create(null),c=Object.create(null),h=Object.create(null);t.forEachNode(function(t){h[t.id]=0}),t.forEachNode(function(d){(function(e){for(t.forEachNode(function(t){var n=t.id;r[n]=[],s[n]=-1,u[n]=0}),s[e]=0,u[e]=1,o.push(e);o.length;){var c=o.shift();i.push(c),t.forEachLinkedNode(c,h,n)}function h(t){var n;n=t.id,-1===s[n]&&(s[n]=s[c]+1,o.push(n)),s[n]===s[c]+1&&(u[n]+=u[c],r[n].push(c))}})(e=d.id),function(){for(t.forEachNode(a);i.length;){for(var n=i.pop(),o=(1+c[n])/u[n],s=r[n],d=0;d<s.length;++d){var f=s[d];c[f]+=u[f]*o}n!==e&&(h[n]+=c[n])}}()}),n||Object.keys(h).forEach(function(t){h[t]/=2});return h;function a(t){c[t.id]=0}}},function(t,n){function e(t,n){var e=0;if(!t)return e;for(var o=0;o<t.length;o+=1)e+=t[o].toId===n?1:0;return e}function o(t,n){var e=0;if(!t)return e;for(var o=0;o<t.length;o+=1)e+=t[o].fromId===n?1:0;return e}function i(t){return t?t.length:0}t.exports=function(t,n){var r,s=Object.create(null);if("both"===(n=(n||"both").toLowerCase())||"inout"===n)r=i;else if("in"===n)r=e;else{if("out"!==n)throw new Error("Expected centrality degree kind is: in, out or both");r=o}return t.forEachNode(function(n){var e=t.getLinks(n.id);s[n.id]=r(e,n.id)}),s}},function(t,n,e){t.exports.degree=e(4),t.exports.betweenness=e(3)},function(t,n){t.exports=function(t,n,e){this.source=t,this.target=n,this.weight=e}},function(t,n){function e(t){this.structure=t.structure?t.structure:t,this.connectionsWeight=new Map,this.connectionsCount=new Map,this.nodes=new Set,this.weightSum=0}e.prototype.size=function(){return this.nodes.size},e.prototype.seed=function(t){this.nodes.add(t),this.weightSum+=this.structure.weights[t]},e.prototype.add=function(t){return this.nodes.add(t),this.weightSum+=this.structure.weights[t],!0},e.prototype.remove=function(t){var n=this.nodes.delete(t);if(this.weightSum-=this.structure.weights[t],!this.nodes.size){var e=this.structure.communities.indexOf(this);delete this.structure.communities[e]}return n},t.exports=e},function(t,n,e){"use strict";var o=e(7),i=e(6);function r(t,n){this.N=t.getNodesCount(),this.graphWeightSum=0,this.structure=this,this.invMap=new Map,this.nodeConnectionsWeight=new Array(this.N),this.nodeConnectionsCount=new Array(this.N),this.nodeCommunities=new Array(this.N),this.map=new Map,this.topology=new Array(this.N);for(var e=0;e<this.N;e++)this.topology[e]=[];this.communities=[],this.weights=new Array(this.N);var i=0;t.forEachNode(function(t){this.map.set(t.id,i),this.nodeCommunities[i]=new o(this),this.nodeConnectionsWeight[i]=new Map,this.nodeConnectionsCount[i]=new Map,this.weights[i]=0,this.nodeCommunities[i].seed(i);var n=new o(this);n.nodes.add(i),this.invMap.set(i,n),this.communities.push(this.nodeCommunities[i]),i++}.bind(this)),t.forEachLink(function(t){var e=this.map.get(t.fromId),o=this.map.get(t.toId),i=1;e!==o&&(n&&(i=t.data.weight),this.setUpLink(e,o,i),this.setUpLink(o,e,i))}.bind(this)),this.graphWeightSum/=2}r.prototype.setUpLink=function(t,n,e){this.weights[t]+=e;var o=new i(t,n,e);this.topology[t].push(o);var r=this.nodeCommunities[n];this.nodeConnectionsWeight[t].set(r,e),this.nodeConnectionsCount[t].set(r,1),this.nodeCommunities[t].connectionsWeight.set(r,e),this.nodeCommunities[t].connectionsCount.set(r,1),this.nodeConnectionsWeight[n].set(this.nodeCommunities[t],e),this.nodeConnectionsCount[n].set(this.nodeCommunities[t],1),this.nodeCommunities[n].connectionsWeight.set(this.nodeCommunities[t],e),this.nodeCommunities[n].connectionsCount.set(this.nodeCommunities[t],1),this.graphWeightSum+=e},r.prototype.addNodeTo=function(t,n){n.add(t),this.nodeCommunities[t]=n;var e=this.topology[t];for(var o in e){var i=e[o],r=i.target,s=this.nodeConnectionsWeight[r].get(n);void 0===s?this.nodeConnectionsWeight[r].set(n,i.weight):this.nodeConnectionsWeight[r].set(n,s+i.weight);var u=this.nodeConnectionsCount[r].get(n);void 0===u?this.nodeConnectionsCount[r].set(n,1):this.nodeConnectionsCount[r].set(n,u+1);var c=this.nodeCommunities[r],h=c.connectionsWeight.get(n);void 0===h?c.connectionsWeight.set(n,i.weight):c.connectionsWeight.set(n,h+i.weight);var a=c.connectionsCount.get(n);void 0===a?c.connectionsCount.set(n,1):c.connectionsCount.set(n,a+1);var d=this.nodeConnectionsWeight[t].get(c);void 0===d?this.nodeConnectionsWeight[t].set(c,i.weight):this.nodeConnectionsWeight[t].set(c,d+i.weight);var f=this.nodeConnectionsCount[t].get(c);if(void 0===f?this.nodeConnectionsCount[t].set(c,1):this.nodeConnectionsCount[t].set(c,f+1),n!=c){var g=n.connectionsWeight.get(c);void 0===g?n.connectionsWeight.set(c,i.weight):n.connectionsWeight.set(c,g+i.weight);var l=n.connectionsCount.get(c);void 0===l?n.connectionsCount.set(c,1):n.connectionsCount.set(c,l+1)}}},r.prototype.removeNodeFrom=function(t,n){var e=this.nodeCommunities[t],o=this.topology[t];for(var i in o){var r=o[i],s=r.target,u=this.nodeConnectionsWeight[s].get(e),c=this.nodeConnectionsCount[s].get(e);c-1==0?(this.nodeConnectionsWeight[s].delete(e),this.nodeConnectionsCount[s].delete(e)):(this.nodeConnectionsWeight[s].set(e,u-r.weight),this.nodeConnectionsCount[s].set(e,c-1));var h=this.nodeCommunities[s],a=h.connectionsWeight.get(e),d=h.connectionsCount.get(e);if(d-1==0?(h.connectionsWeight.delete(e),h.connectionsCount.delete(e)):(h.connectionsWeight.set(e,a-r.weight),h.connectionsCount.set(e,d-1)),t!=s){if(h!=e){var f=e.connectionsWeight.get(h),g=e.connectionsCount.get(h);g-1==0?(e.connectionsWeight.delete(h),e.connectionsCount.delete(h)):(e.connectionsWeight.set(h,f-r.weight),e.connectionsCount.set(h,g-1))}var l=this.nodeConnectionsWeight[t].get(h),p=this.nodeConnectionsCount[t].get(h);p-1==0?(this.nodeConnectionsWeight[t].delete(h),this.nodeConnectionsCount[t].delete(h)):(this.nodeConnectionsWeight[t].set(h,l-r.weight),this.nodeConnectionsCount[t].set(h,p-1))}}n.remove(t)},r.prototype.moveNodeTo=function(t,n){var e=this.nodeCommunities[t];this.removeNodeFrom(t,e),this.addNodeTo(t,n)},r.prototype.zoomOut=function(){var t=this.communities.reduce(function(t,n){return t.push(n),t},[]),n=t.length,e=new Array(n),r=0;this.nodeCommunities=new Array(n),this.nodeConnectionsWeight=new Array(n),this.nodeConnectionsCount=new Array(n);var s=new Map;t.forEach(function(n){var u=0;this.nodeConnectionsWeight[r]=new Map,this.nodeConnectionsCount[r]=new Map,e[r]=[],this.nodeCommunities[r]=new o(n);var c=new o(this.structure);n.nodes.forEach(function(t){this.invMap.get(t).nodes.forEach(c.nodes.add.bind(c.nodes))},this),s.set(r,c),n.connectionsWeight.forEach(function(n,o){var s=t.indexOf(o);if(~s){u+=s==r?2*n:n;var c=new i(r,s,n);e[r].push(c)}},this),this.weights[r]=u,this.nodeCommunities[r].seed(r),r++}.bind(this)),this.communities=[];for(var u=0;u<n;u++){var c=this.nodeCommunities[u];for(var h in this.communities.push(c),e[u]){var a=e[u][h];this.nodeConnectionsWeight[u].set(this.nodeCommunities[a.target],a.weight),this.nodeConnectionsCount[u].set(this.nodeCommunities[a.target],1),c.connectionsWeight.set(this.nodeCommunities[a.target],a.weight),c.connectionsCount.set(this.nodeCommunities[a.target],1)}}this.N=n,this.topology=e,this.invMap=s},t.exports=r},function(t,n,e){var o=e(8),i=e(5);function r(t,n){this.isRandomized=!1,this.useWeight=n,this.resolution=t||1,this.structure=null}r.prototype.execute=function(t){this.structure=new o(t,this.useWeight);var n=new Array(t.getNodesCount()),e=(this.computeModularity(t,this.structure,n,this.resolution,this.isRandomized,this.useWeight),{});return this.structure.map.forEach(function(t,o){e[o]=n[t]}),e},r.prototype.computeModularity=function(t,n,e,o,i,r){n.graphWeightSum,n.weights.slice();for(var s,u,c=Object.create(null),h=!0;h;){h=!1;for(var a=!0;a;){a=!1;var d=0;i&&(s=0,u=n.N,d=Math.floor(Math.random()*(u-s))+s);for(var f=0,g=d;f<n.N;g=(g+1)%n.N){f++;var l=this.updateBestCommunity(n,g,o);n.nodeCommunities[g]!=l&&null!=l&&(n.moveNodeTo(g,l),a=!0)}h=a||h}h&&n.zoomOut()}return this.fillComStructure(t,n,e),c},r.prototype.updateBestCommunity=function(t,n,e){var o=this.q(n,t.nodeCommunities[n],t,e),i=t.nodeCommunities[n];return t.nodeConnectionsWeight[n].forEach(function(r,s){var u=this.q(n,s,t,e);u>o&&(o=u,i=s)},this),i},r.prototype.fillComStructure=function(t,n,e){var o=0;return n.communities.forEach(function(t){t.nodes.forEach(function(t){n.invMap.get(t).nodes.forEach(function(t){e[t]=o})}),o++}),e},r.prototype.fillDegreeCount=function(t,n,e,o,r){var s=new Array(n.communities.length),u=i.degree(t);return t.forEachNode(function(t){var i=n.map.get(t);s[e[i]]+=r?o[i]:u[t.id]}),s},r.prototype._finalQ=function(t,n,e,o,i,r,s){throw new Error("not implemented properly")},r.prototype.q=function(t,n,e,o){var i=e.nodeConnectionsWeight[t].get(n),r=0;null!=i&&(r=i);var s=n.weightSum,u=e.weights[t],c=o*r-u*s/(2*e.graphWeightSum);return e.nodeCommunities[t]==n&&e.nodeCommunities[t].size()>1&&(c=o*r-u*(s-u)/(2*e.graphWeightSum)),e.nodeCommunities[t]==n&&1==e.nodeCommunities[t].size()&&(c=0),c},t.exports=r},function(t,n,e){var o=e(9),i=e(2),r=e(1);function s(t){return function(n,e){var i={};n.eachSeriesByType(t,function(t){var n=[];if(t.get("modularity")){var s=t.getGraph(),u={},c=r();s.data.each(function(t){var n=s.getNodeByIndex(t);return u[n.id]=t,c.addNode(n.id),n.id}),s.edgeData.each("value",function(t,n){var e=s.getEdgeByIndex(n);return c.addLink(e.node1.id,e.node2.id),{source:e.node1.id,target:e.node2.id,value:t}});var h=new o(t.get("modularity.resolution")||1).execute(c),a={},d={};for(var f in h){a[p=h[f]]=a[p]||0,a[p]++,d[p]?d[p].push(f):d[p]=[f]}var g=Object.keys(a);t.get("modularity.sort")&&g.sort(function(t,n){return n-t});var l={};for(var f in g.forEach(function(e){l[e]=t.getColorFromPalette(e,i),n.push({nodes:d[e],color:l[e]})}),h){var p=h[f];s.data.setItemVisual(u[f],"color",l[p])}s.edgeData.each(function(t){var n=s.edgeData.getItemModel(t),e=s.getEdgeByIndex(t),o=n.get("lineStyle.normal.color");switch(o){case"source":o=e.node1.getVisual("color");break;case"target":o=e.node2.getVisual("color")}null!=o&&e.setVisual("color",o)})}e.getCommunities=function(){return n}})}}i.registerVisual(i.PRIORITY.VISUAL.CHART+1,s("graph")),i.registerVisual(i.PRIORITY.VISUAL.CHART+1,s("graphGL"))},function(t,n,e){t.exports=e(10)}])});